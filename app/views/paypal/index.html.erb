<h1>
  Smart Payment Buttons Overview
</h1>

<div class="description">
  <p>
    PayPal Checkout with Smart Payment Buttons gives your buyers a simplified
    and secure checkout experience. PayPal intelligently presents the most
    relevant payment types to your shoppers, automatically, making it easier
    for them to complete their purchase using methods like Pay with Venmo,
    PayPal Credit, Credit Card payments, and other payment types.
  </p>
</div>

<div id="paypal-button-container"></div>

<script type="text/javascript">
  paypal.Button.render({

    env: 'sandbox', // sandbox | production

    // Show the buyer a 'Pay Now' button in the checkout flow
    commit: true,

    // payment() is called when the button is clicked
    payment: function() {

      // Set up a url on your server to create the payment
      var CREATE_URL = "<%= checkout_url %>";

      // Make a call to your server to set up the payment
      return paypal.request.post(CREATE_URL).then(function(res) {
        return res.paymentID;
      });
    },

    // onAuthorize() is called when the buyer approves the payment
    onAuthorize: function(data, actions) {

      // Set up a url on your server to execute the payment
      var EXECUTE_URL = "<%= execute_url %>";

      // Set up the data you need to pass to your server
      var data = {
        paymentID: data.paymentID,
        payerID: data.payerID
      };

      // Make a call to your server to execute the payment
      return paypal.request.post(EXECUTE_URL, data).then(function (res) {
        if (res.success == true) {
          window.alert(res.msg);
        } else {
          window.alert(res.msg["details"][0]["issue"]);
        }
      });
    }

  }, '#paypal-button-container');
</script>
